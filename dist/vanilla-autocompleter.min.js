!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VanillaAutocompleter=t()}(this,(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(s=n.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),n)}var s,o}function i(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var n="selected",s="hl",o=function(){function t(i,n){e(this,t),this.parent=i,this.element=n.element,this.arrowNav=n.arrowNav,this.inputValue=n.inputValue,this.showOnFocus=n.showOnFocus,this.debounceDelay=n.debounceDelay,this.query="",this.setUpKeyEventHandler(),this.setUpBlurHandler(),this.showOnFocus&&this.setUpFocusHandler(),this.arrowNav&&this.setUpArrowNavHandler()}return i(t,[{key:"keyEventHandler",value:function(e){var t=this.element.value;this.query=t,this.parent.selection.activate()}},{key:"setUpKeyEventHandler",value:function(){var e=this,t=null;this.element.addEventListener("input",(function(){e.parent.selection.customMakeSelection&&e.parent.suggestionsBox.showLoadingMessage(),clearTimeout(t),t=setTimeout(e.keyEventHandler.bind(e),e.debounceDelay)}))}},{key:"arrowNavHandler",value:function(e){this.parent.suggestionsBox.noSuggestions()||(40===e.keyCode?(this.parent.suggestionsBox.goDown(),e.preventDefault()):38===e.keyCode?(this.parent.suggestionsBox.goUp(),e.preventDefault()):13===e.keyCode&&this.parent.suggestionsBox.handleEnter())}},{key:"setUpArrowNavHandler",value:function(){this.element.addEventListener("keydown",this.arrowNavHandler.bind(this))}},{key:"blurHandler",value:function(e){this.parent.suggestionsBox.mouseDown?this.parent.suggestionsBox.mouseDown=!1:this.parent.suggestionsBox.hide()}},{key:"setUpBlurHandler",value:function(){this.element.addEventListener("blur",this.blurHandler.bind(this))}},{key:"focusHandler",value:function(e){this.parent.selection.activate()}},{key:"setUpFocusHandler",value:function(){this.element.addEventListener("focus",this.focusHandler.bind(this))}},{key:"setInputValue",value:function(e){var t=this.inputValue(e);this.query=t,this.element.value=t}}],[{key:"defaultInputValue",value:function(e){return e}}]),t}(),a=function(){function t(i,n){e(this,t),this.parent=i,this.matchTarget=n.matchTarget,this.makeSelection=n.makeSelection,this.isMatch=n.isMatch,this.allOnEmpty=n.allOnEmpty,this.highlight=n.highlight,this.highlightTarget=n.highlightTarget,this.customMakeSelection=!1,this.makeSelection!==t.defaultMakeSelection&&(this.customMakeSelection=!0)}return i(t,[{key:"highlightMatchAndStore",value:function(e,t){var i,n=this.highlightTarget(e).split(""),s=t[0];n[s]="<b>"+n[s];var o=t[1];n[o]=n[o]+"</b>",i=n.join(""),this.parent.store.addHighlightedMatch(i)}},{key:"doneLoadingData",value:function(){this.parent.suggestionsBox.shown&&this.activate()}},{key:"doneMakingSelection",value:function(e){this.proceed(e)}},{key:"proceed",value:function(e){e.length?(this.parent.store.matches=e,this.parent.ordering.activate(e)):this.parent.suggestionsBox.noMatch()}},{key:"activate",value:function(){var e=this.parent.input.query;if(this.parent.store.reset(),0!==e.length||this.allOnEmpty)if(this.parent.store.isLoading)this.parent.suggestionsBox.showLoadingMessage();else{var t=this.makeSelection(e,this.doneMakingSelection.bind(this));if(t instanceof Promise)return this.parent.suggestionsBox.showLoadingMessage(),void t.then(this.doneMakingSelection.bind(this));void 0!==t?this.proceed(t):this.parent.suggestionsBox.showLoadingMessage()}else this.parent.suggestionsBox.hide()}}],[{key:"defaultHighlightTarget",value:function(e){return e}},{key:"defaultMatchTarget",value:function(e){return e}},{key:"defaultIsMatch",value:function(e,t){var i=this.matchTarget(t).toLowerCase().indexOf(e.toLowerCase());return-1!==i&&[i,i+e.length-1]}},{key:"defaultMakeSelection",value:function(e){var t=[];if(0===e.length)return t=this.parent.store.data;var i=this;return this.parent.store.data.forEach((function(n){var s=i.isMatch(e,n);s&&(i.highlight&&i.highlightMatchAndStore(n,s),t.push(n))})),t}}]),t}(),r=function(){function t(i,n){e(this,t),this.parent=i,this.element=n.element,this.loadingHTML=n.loadingHTML,this.multiple=n.multiple,this.getSelectionId=n.getSelectionId,this.mouseDown=!1,this.setUpMouseDownHandler(),this.suggestionElements=null,this.navIndex=-1,this.onSelect=n.onSelect,this.setUpClickHandler()}return i(t,[{key:"noSuggestions",value:function(){return!this.suggestionElements||0===this.suggestionElements.length}},{key:"refreshSuggestionElements",value:function(){this.suggestionElements=this.element.querySelectorAll(".ac_suggestion")}},{key:"show",value:function(e){this.element.innerHTML=e,this.element.classList.add("ac_suggestions--shown"),this.refreshSuggestionElements(),this.navIndex=-1,this.shown=!0}},{key:"hide",value:function(){this.element.innerHTML="",this.element.classList.remove("ac_suggestions--shown"),this.shown=!1}},{key:"put",value:function(e){this.element.innerHTML=e}},{key:"selectWithMultiple",value:function(e){e.classList.add(n)}},{key:"unselectWithMultiple",value:function(e){e.classList.remove(n)}},{key:"selectEntryWithMultiple",value:function(e,t){var i=this.getSelectionId(t),n=this.parent.store,s=this.parent.presentation.showSelected;n.existsSelection(i)?(n.removeSelection(i),this.unselectWithMultiple(e)):(n.addSelection(i),s?this.selectWithMultiple(e,t):(e.parentNode.removeChild(e),this.refreshSuggestionElements(),this.highlightLi(),this.suggestionElements.length||this.noMatch()))}},{key:"select",value:function(e){var t,i=e.getAttribute("data-index"),n=this.parent.store.matches[i];(this.multiple?this.selectEntryWithMultiple(e,n):(this.parent.input.setInputValue(n),this.parent.suggestionsBox.hide()),this.onSelect)&&(this.multiple&&(t=this.getSelectionId(n)),this.onSelect(n,t))}},{key:"handleEnter",value:function(){var e=this.navIndex;if(-1!==e){var t=this.suggestionElements[e];this.select(t)}}},{key:"clickHandler",value:function(e){var t=e.target.isItselfOrWithin(".ac_suggestion");t&&this.select(t)}},{key:"setUpClickHandler",value:function(){this.element.addEventListener("click",this.clickHandler.bind(this))}},{key:"bringSuggestionInView",value:function(){var e=this.navIndex,t=this.element;if(-1!==e){var i=t.clientHeight,n=this.suggestionElements[e],s=n.offsetTop,o=n.clientHeight;s+o-t.scrollTop>i?t.scrollTop=s+o-i:t.scrollTop>s&&(t.scrollTop=s)}}},{key:"highlightLi",value:function(){var e=this.navIndex,t=this.suggestionElements;t[e]?t[e].classList.add(s):this.navIndex=-1}},{key:"goDown",value:function(){var e=this.navIndex,t=this.suggestionElements;-1===e?t[++e].classList.add(s):e===t.length-1?(t[e].classList.remove(s),this.element.scrollTop=0,e=-1):(t[e].classList.remove(s),t[++e].classList.add(s)),this.navIndex=e,this.bringSuggestionInView()}},{key:"goUp",value:function(){var e=this.navIndex,t=this.suggestionElements;-1===e?t[e=t.length-1].classList.add(s):0===e?(t[e].classList.remove(s),e=-1):(t[e].classList.remove(s),t[--e].classList.add(s)),this.navIndex=e,this.bringSuggestionInView()}},{key:"noMatch",value:function(){this.show("Nothing found.")}},{key:"showLoadingMessage",value:function(){this.show(this.loadingHTML())}},{key:"mouseDownHandler",value:function(e){this.mouseDown=!0}},{key:"setUpMouseDownHandler",value:function(){this.element.addEventListener("mousedown",this.mouseDownHandler.bind(this))}}],[{key:"defaultLoadingHTML",value:function(){return"Loading..."}},{key:"defaultGetSelectionId",value:function(e){return e}}]),t}(),l=function(){function t(i,n){e(this,t),this.parent=i,this.suggestionHTML=n.suggestionHTML,this.prevGroupName=null,this.showSelected=n.showSelected}return i(t,[{key:"prependGroupIfNeeded",value:function(e,t){var i="",n=e(t);return this.prevGroupName!==n&&(i='<li class="'.concat("ac_group",'">').concat(n,"</li>"),this.prevGroupName=n),i}},{key:"getSuggestionsHTML",value:function(e,t){var i="<ul>",n=0,s=this,o=this.parent.ordering.group,a=this.parent.suggestionsBox,r=a.multiple,l=!1;return e.forEach((function(e){o&&(i+=s.prependGroupIfNeeded(o,e));var u="";if(r){var h=a.getSelectionId(e);if(s.parent.store.existsSelection(h)&&(u=" selected",!s.showSelected))return void n++}i+='<li data-index="'.concat(n,'" class="').concat("ac_suggestion"+u,'">')+s.suggestionHTML(e,t[n])+"</li>",l=!0,n++})),i+="</ul>",l&&i}},{key:"activate",value:function(){var e=this.parent.store.matches,t=this.parent.store.highlightedMatches,i=this.getSuggestionsHTML(e,t);i?this.parent.suggestionsBox.show(i):this.parent.suggestionsBox.noMatch()}}],[{key:"defaultSuggestionHTML",value:function(e,t){return t||e}}]),t}(),u=function(){function t(i,n){e(this,t),this.parent=i,this.data=n.data,this.initData=n.initData,this.matches=null,this.highlightedMatches=[],this.selectedEntries={},this.isLoading=!1,this.initData&&this.loadData()}return i(t,[{key:"update",value:function(e){this.matches=e}},{key:"doneLoadingData",value:function(e){this.isLoading=!1,this.data=e,this.parent.selection.doneLoadingData()}},{key:"loadData",value:function(){var e=this.doneLoadingData.bind(this);this.isLoading=!0;var t=this.initData(e);t instanceof Promise&&t.then(e)}},{key:"reset",value:function(){this.highlightedMatches=[]}},{key:"addHighlightedMatch",value:function(e){this.highlightedMatches.push(e)}},{key:"addSelection",value:function(e){this.selectedEntries[e]=!0}},{key:"existsSelection",value:function(e){return e in this.selectedEntries}},{key:"removeSelection",value:function(e){delete this.selectedEntries[e]}}]),t}(),h=function(){function t(i,n){e(this,t),this.parent=i,this.group=n.group,this.sort=n.sort,this.sortGroup=n.sortGroup}return i(t,[{key:"getGroupNamesMap",value:function(){var e=this.parent.store.matches,t={},i=this;return e.forEach((function(e){var n=i.group(e);t[n]||(t[n]=[]),t[n].push(e)})),t}},{key:"doOrder",value:function(){return!!(this.group||this.sort||this.sortGroup)}},{key:"activate",value:function(){if(this.doOrder()&&this.group){var e=this.getGroupNamesMap(),t=Object.keys(e);if(this.sortGroup&&t.sort(this.sortGroup),this.sort)for(var i in e)e[i].sort(this.sort);var n=[];t.forEach((function(t){n=n.concat(e[t])})),this.parent.store.matches=n}this.parent.presentation.activate()}}],[{key:"defaultGroup",value:function(e){return e.charAt(0)}},{key:"ascSorting",value:function(e,t){return e<t?-1:e>t?1:0}},{key:"descSorting",value:function(e,t){return e<t?1:e>t?-1:0}}]),t}();Element.prototype.matchesSelector=function(e){return/^\w+$/.test(e)?this.nodeName.toLowerCase()===e:/^\./.test(e)?this.classList.contains(e.slice(1)):/^\#/.test(e)?this.getAttribute("id")===e.slice(1):void 0},Element.prototype.isItselfOrWithin=function(e){var t=this;for(e=e.toLowerCase();t!==document&&null!==t;){if(t.matchesSelector(e))return t;t=t.parentNode}return!1};var c=function(){function t(i){e(this,t);var n=this.defaults();for(var s in i)n[s]=i[s];if(n.highlight&&i.makeSelection)throw new Error("Options `highlight` and `makeSelection` can't be set together.");this.input=new o(this,{element:n.inputElement,arrowNav:n.arrowNav,hideOnBlur:n.hideOnBlur,inputValue:n.inputValue,showOnFocus:n.showOnFocus,debounceDelay:n.debounceDelay}),this.suggestionsBox=new r(this,{element:n.suggestionsBoxElement,onSelect:n.onSelect,loadingHTML:n.loadingHTML,multiple:n.multiple,getSelectionId:n.getSelectionId}),this.selection=new a(this,{makeSelection:n.makeSelection,matchTarget:n.matchTarget,isMatch:n.isMatch,allOnEmpty:n.allOnEmpty,highlight:n.highlight,highlightTarget:n.highlightTarget}),this.store=new u(this,{data:n.data,initData:n.initData}),this.ordering=new h(this,{group:n.group,sort:n.sort,sortGroup:n.sortGroup}),this.presentation=new l(this,{suggestionHTML:n.suggestionHTML,showSelected:n.showSelected})}return i(t,[{key:"unselect",value:function(e){this.store.removeSelection(e)}},{key:"defaults",value:function(){var e={data:null,initData:null,allOnEmpty:!1,inputElement:null};return e.inputValue=o.defaultInputValue,e.debounceDelay=0,e.suggestionsBoxElement=null,e.suggestionHTML=l.defaultSuggestionHTML,e.multiple=!1,e.getSelectionId=r.defaultGetSelectionId,e.showSelected=!0,e.matchTarget=a.defaultMatchTarget,e.loadingHTML=r.defaultLoadingHTML,e.onSelect=null,e.makeSelection=a.defaultMakeSelection,e.isMatch=a.defaultIsMatch,e.arrowNav=!0,e.removeOnBlur=!0,e.hideOnBlur=!0,e.showOnFocus=!1,e.group=null,e.sort=null,e.sortGroup=null,e.highlight=!1,e.highlightTarget=a.defaultHighlightTarget,e}}]),t}();return c.ascSorting=h.ascSorting,c.descSorting=h.descSorting,c.groupByFirstLetter=h.defaultGroup,c}));
